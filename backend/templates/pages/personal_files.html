{{ template "header.html" . }}

<div class="w-full h-full px-6">
    <div class="flex justify-items-start items-center mb-4 gap-4">
        <h3 class="text-lg font-semibold text-gray-700">
            Your files
        </h3>

        <div id="dropdown-container" class="relative">
            <button id="new-button" type="button" class="inline-flex items-center justify-center px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-md shadow-sm transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                New
            </button>

            <div id="dropdown-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-20">
                <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="new-button">
                    <button id="upload-file-button" type="button" class="w-full text-left flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        Upload File
                    </button>
                    <button id="new-folder-button" type="button" class="w-full text-left flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                        </svg>
                        New folder
                    </button>
                </div>
            </div>
        </div>
    </div>


    <form hx-post="/files/upload"
          hx-target="#file-rows"
          hx-swap="innerHTML"
          enctype="multipart/form-data"
          class="hidden">
            <input id="files"
                   name="files"
                   type="file"
                   multiple
                   class="sr-only"
            >

        <ul id="selected-files" class="mt-2 text-sm text-gray-600 space-y-1"></ul>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const form  = document.querySelector('form[hx-post="/files/upload"]');
                const input = document.getElementById('files');
                const list  = document.getElementById('selected-files');

                const newButton = document.getElementById("new-button")
                const dropdownMenu = document.getElementById("dropdown-menu")
                const uploadFileButton = document.getElementById("upload-file-button")

                newButton.addEventListener('click', (event) => {
                    event.stopPropagation()
                    dropdownMenu.classList.toggle('hidden')
                })

                window.addEventListener('click', () => {
                    if (!dropdownMenu.classList.contains('hidden')) {
                        dropdownMenu.classList.add('hidden')
                    }
                })

                uploadFileButton.addEventListener('click', () => {
                    dropdownMenu.classList.add('hidden')
                    input.click()
                })


                // show selected files
                input.addEventListener('change', () => {
                    list.innerHTML = '';
                    [...input.files].forEach(f => {
                        const li = document.createElement('li');
                        li.textContent = f.name;
                        list.appendChild(li);
                    });

                    if(input.files.length > 0) {
                        htmx.trigger(form, 'submit')
                    }
                });

                // clear after successful upload
                form.addEventListener('htmx:afterRequest', (evt) => {
                    if (evt.detail.successful) {
                        list.innerHTML = '';
                        input.value   = '';
                    }
                });
            });
        </script>

        <button type="submit"
                class="w-full py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition">
            Upload
        </button>
    </form>

    <div id="file-list" class="mt-6">
        <table class="w-full text-sm text-gray-700">
            <colgroup>
                <col style="width: 80%;">
                <col style="width: 10%;">
                <col style="width: 10%;">
            </colgroup>
            <thead>
            <tr class="border-b">
                <th class="text-left py-2 font-semibold">Name</th>
                <th class="text-left py-2 font-semibold">Uploaded</th>
                <th class="text-right py-2 font-semibold">Size</th>
            </tr>
            </thead>
            <tbody id="file-rows">
            {{ template "file_rows" . }}
            </tbody>
        </table>
    </div>

    <div class="mt-10 text-center">
        <a href="/backend/static" class="text-blue-500 hover:underline">‚Üê Back to dashboard</a>
    </div>
</div>

{{ template "footer.html" . }}